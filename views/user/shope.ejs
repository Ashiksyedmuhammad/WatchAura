<%- include('../user-layouts/header.ejs') %>



    <style>
        /* .box-navigation, .nav-icon {
    padding: 0;
    margin: 0;
}

.box-nav-ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.box-nav-ul .menu-item {
    font-size: 1rem;
}

.box-nav-ul .menu-item a {
    color: #333;
    text-decoration: none;
    padding: 8px 12px;
    font-weight: 500;
    display: flex;
    align-items: center;
}

.box-nav-ul .menu-item a:hover {
    color: #007bff;
}

.nav-icon-item {
    color: #333;
    font-size: 1.2rem;
    display: flex;
    align-items: center;
}

.nav-icon-item:hover {
    color: #007bff;
}

.btn-logout {
    color: #333;
    font-size: 1.1rem;
}

.btn-logout:hover {
    color: #dc3545;
}

.nav-icon .count-box {
    background-color: #dc3545;
    color: #fff;
    border-radius: 50%;
    font-size: 0.75rem;
    padding: 2px 6px;
    margin-left: 4px;
}

.nav-user p {
    margin: 0;
    font-size: 1rem;
    font-weight: bold;
    color: #333;
} */


        .offer-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 2;
        }

        .price-container {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .original-price {
            font-size: 0.9em;
            color: #666;
        }

        .offer-price {
            color: #dc3545;
            font-weight: bold;
        }

       /* Filter Section */
.filter-section {
    background-color: #f8f9fa; /* Light background for contrast */
    padding: 1.5rem; /* Add padding for spacing */
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.filter-section .form-control,
.filter-section .form-select {
    height: 42px;
    font-size: 0.95rem;
    padding: 0.375rem 0.75rem;
    border: 1px solid #ced4da;
    border-radius: 6px;
    transition: border-color 0.2s ease-in-out;
}

.filter-section .form-control:focus,
.filter-section .form-select:focus {
    border-color: #007bff;
    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
}

.filter-section .input-group .form-control {
    border-radius: 6px;
}

.filter-section .input-group input[type="number"] {
    width: 50%; /* Make min and max inputs share equal space */
}

.filter-section .input-group .form-control:first-child {
    border-top-right-radius: 0;
    border-bottom-right-radius: 0;
}

.filter-section .input-group .form-control:last-child {
    border-top-left-radius: 0;
    border-bottom-left-radius: 0;
}

.mb-3 {
    margin-bottom: 1rem !important; 
}

.filter-section .form-select {
    padding-right: 1.75rem; 
}


@media (max-width: 767px) {
    .filter-section {
        padding: 1rem;
    }
}


        .pagination {
            display: flex;
            list-style-type: none;
            padding: 0;
        }
    </style>

    </head>

    <body class="preload-wrapper">
        <!-- preload -->
        <!-- <div class="preload preload-container">
        <div class="preload-logo">
            <div class="spinner"></div>
        </div>
    </div> -->
        <!-- /preload -->
        <div id="wrapper">
            <!-- Top bar -->
            <div class="tf-top-bar bg_white line">
                <div class="px_15 lg-px_40">

                </div>
            </div>
            <!-- /Top bar -->
            <!-- Header -->
           
            <header id="header" class="header-default">
                <div class="px_15 lg-px_40">
                    <div class="row wrapper-header align-items-center">
                        <div class="col-md-4 col-3 tf-lg-hidden">
                            <a href="#mobileMenu" data-bs-toggle="offcanvas" aria-controls="offcanvasLeft">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="16" viewBox="0 0 24 16"
                                    fill="none">
                                    <path
                                        d="M2.00056 2.28571H16.8577C17.1608 2.28571 17.4515 2.16531 17.6658 1.95098C17.8802 1.73665 18.0006 1.44596 18.0006 1.14286C18.0006 0.839753 17.8802 0.549063 17.6658 0.334735C17.4515 0.120408 17.1608 0 16.8577 0H2.00056C1.69745 0 1.40676 0.120408 1.19244 0.334735C0.978109 0.549063 0.857702 0.839753 0.857702 1.14286C0.857702 1.44596 0.978109 1.73665 1.19244 1.95098C1.40676 2.16531 1.69745 2.28571 2.00056 2.28571ZM0.857702 8C0.857702 7.6969 0.978109 7.40621 1.19244 7.19188C1.40676 6.97755 1.69745 6.85714 2.00056 6.85714H22.572C22.8751 6.85714 23.1658 6.97755 23.3801 7.19188C23.5944 7.40621 23.7148 7.6969 23.7148 8C23.7148 8.30311 23.5944 8.59379 23.3801 8.80812C23.1658 9.02245 22.8751 9.14286 22.572 9.14286H2.00056C1.69745 9.14286 1.40676 9.02245 1.19244 8.80812C0.978109 8.59379 0.857702 8.30311 0.857702 8ZM0.857702 14.8571C0.857702 14.554 0.978109 14.2633 1.19244 14.049C1.40676 13.8347 1.69745 13.7143 2.00056 13.7143H12.2863C12.5894 13.7143 12.8801 13.8347 13.0944 14.049C13.3087 14.2633 13.4291 14.554 13.4291 14.8571C13.4291 15.1602 13.3087 15.4509 13.0944 15.6653C12.8801 15.8796 12.5894 16 12.2863 16H2.00056C1.69745 16 1.40676 15.8796 1.19244 15.6653C0.978109 15.4509 0.857702 15.1602 0.857702 14.8571Z"
                                        fill="currentColor"></path>
                                </svg>
                            </a>
                        </div>
                        <div class="col-xl-3 col-md-4 col-6">
                            <a href="index.html" class="logo-header">
                                <img src="assets/images/logo/WL.png" alt="logo" class="logo" style="width: 100px;">
                            </a>
                        </div>
                        <div class="col-xl-6 col-md-6 d-none d-md-flex justify-content-center">
                            <nav class="box-navigation text-center">
                                <ul class="box-nav-ul d-flex align-items-center justify-content-center gap-3">
                                    <li class="menu-item">
                                        <a href="/" class="item-link">Home<i class="icon icon-arrow-down ms-1"></i></a>
                                    </li>
                                    <li class="menu-item">
                                        <a href="/shop" class="item-link">Shop<i class="icon icon-arrow-down ms-1"></i></a>
                                    </li>
                                    <li class="menu-item">
                                        <a href="#" class="item-link">About<i class="icon icon-arrow-down ms-1"></i></a>
                                    </li>
                                    <li class="menu-item">
                                        <a href="#" class="item-link">Contact<i class="icon icon-arrow-down ms-1"></i></a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                        <div class="col-xl-3 col-md-6 col-6 d-flex justify-content-end">
                            <ul class="nav-icon d-flex align-items-center gap-3">
                               
                                <% if(locals.userData){ %>
                                    <li class="nav-user">
                                        <a href="/profile" class="nav-icon-item">
                                            <p class="mb-0"><%= locals.userData?.firstName %></p>
                                        </a>
                                    </li>
                                    <li class="nav-logout">
                                        <form action="/logout" method="POST" class="d-inline">
                                            <button type="submit" class="btn-logout" style="background: none; border: none; padding: 0;">
                                                <i class="icon icon-logout"></i> 
                                            </button>
                                        </form>
                                    </li>
                                <% } else { %>
                                    <li class="nav-account">
                                        <a href="#login" data-bs-toggle="modal" class="nav-icon-item">
                                            <i class="icon icon-account"></i> 
                                        </a>
                                    </li>
                                <% } %>
                                <li class="nav-wishlist">
                                    <a href="/wishlist" class="nav-icon-item">
                                      <i class="icon icon-heart"></i>
                                    </a>
                                  </li>
                                <li class="nav-cart">
                                    <a href="/cart" class="nav-icon-item">
                                        <i class="icon icon-bag"></i>
                                    </a>
                                </li>
                            </ul>
                        </div>
                        
                    </div>
                </div>
            </header>

            <div class="tf-page-title">
                <div class="container-full">
                    <div class="heading text-center">SHOP</div>
                    <p class="text-center text-2 text_black-2 mt_5">Shop through our all products</p>
                </div>
            </div>
            <div class="filter-section mb-4">
                <div class="container">
                    <div class="row">
                        <!-- Search Bar -->
                        <div class="col-md-4 mb-3">
                            <input type="text" id="searchInput" class="form-control" placeholder="Search products..."
                                value="<%= filters?.search || '' %>">
                        </div>

                        <!-- Sort Dropdown -->
                        <div class="col-md-3 mb-3">
                            <select id="sortSelect" class="form-select">
                                <option value="featured" <%=filters?.sort==='featured' ? 'selected' : '' %>>Featured
                                </option>
                                <option value="popularity" <%=filters?.sort==='popularity' ? 'selected' : '' %>
                                    >Popularity</option>
                                <option value="price_asc" <%=filters?.sort==='price_asc' ? 'selected' : '' %>>Price: Low
                                    to High</option>
                                <option value="price_desc" <%=filters?.sort==='price_desc' ? 'selected' : '' %>>Price:
                                    High to Low</option>
                                <option value="newest" <%=filters?.sort==='newest' ? 'selected' : '' %>>New Arrivals
                                </option>
                                <option value="name_asc" <%=filters?.sort==='name_asc' ? 'selected' : '' %>>Name: A to Z
                                </option>
                                <option value="name_desc" <%=filters?.sort==='name_desc' ? 'selected' : '' %>>Name: Z to
                                    A</option>
                            </select>
                        </div>

                        <!-- Category Filter -->
                        <div class="col-md-3 mb-3">
                            <select id="categorySelect" class="form-select">
                                <option value="">All Categories</option>
                                <% categories.forEach(category=> { %>
                                    <option value="<%= category._id %>" <%=filters?.category===category._id.toString()
                                        ? 'selected' : '' %>>
                                        <%= category.categoryName %>
                                    </option>
                                    <% }); %>
                            </select>
                        </div>

                        <!-- Price Range -->
                        <div class="col-md-2 mb-3">
                            <div class="input-group">
                                <input type="number" id="minPrice" class="form-control" placeholder="Min"
                                    value="<%= filters?.minPrice || '' %>">
                                <input type="number" id="maxPrice" class="form-control" placeholder="Max"
                                    value="<%= filters?.maxPrice || '' %>">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <section class="flat-spacing-2">
                <div class="container">
                    <div class="wrapper-control-shop">
                        <div class="meta-filter-shop"></div>
                        <div class="grid-layout wrapper-shop" data-grid="grid-4">
                            <% products.forEach(product=> { %>

                                <% 
                                    let bestDiscount=0;
                                     let hasDiscount=false;
                                      let discountedPrice=product.price;
                                    offers.forEach((item)=> {
                                    if (item.type === 'PRODUCT') {
                                    item.products.forEach((Product) => {
                                    if (String(product._id) === String(Product._id)) {
                                    if (item.discount > bestDiscount) {
                                    bestDiscount = item.discount;
                                    hasDiscount = true;
                                    discountedPrice = product.price * (1 - bestDiscount / 100);
                                    }
                                    }
                                    });
                                    }
                                    });
                                
                                    offers.forEach((item) => {
                                    if (item.type === 'CATEGORY') {

                                    let categoryMatch = Array.isArray(item.categories)
                                    ? item.categories.some(category => String(product.category) ===
                                    String(category._id))
                                    : String(product.category) === String(item.categories._id);

                                    if (categoryMatch && item.discount > bestDiscount) {
                                    bestDiscount = item.discount;
                                    hasDiscount = true;
                                    discountedPrice = product.price * (1 - bestDiscount / 100);
                                    }
                                    }
                                    });
                                %>
                                
                                
                                    
                                        <div class="card-product" data-price="<%= product.price %>">
                                            <div class="card-product-wrapper">
                                                <a href="/product/<%= product._id %>" class="product-img">
                                                    <img class="img-product ls-is-cached lazyloaded"
                                                        data-src="<%= product.images[0] %>"
                                                        src="/uploads/<%= product.images[0] %>"
                                                        alt="<%= product.productName %>">
                                                    <% if (product.images[1]) { %>
                                                        <img class="img-hover ls-is-cached lazyloaded"
                                                            src="/uploads/<%= product.images[1] %>"
                                                            alt="<%= product.productName %>">
                                                        <% } %>

                                                            <% if (product.offerId && product.offerId.status===true &&
                                                                new Date(product.offerId.expiryDate)> new Date()) { %>
                                                                <div class="offer-badge">
                                                                    <span class="badge bg-danger">
                                                                        <%= product.offerId.discount %>% OFF
                                                                    </span>
                                                                </div>
                                                                <% } %>
                                                </a>
                                                <div class="list-product-btn absolute-2">
                                                    <% if(locals.userData && locals.userData?.firstName) { %>
                                                        <a href="#quick_add" data-bs-toggle="modal"
                                                            class="box-icon bg_white quick-add tf-btn-loading"
                                                            data-product-id="<%= product._id %>"
                                                            data-user-id="<%= locals.userData?._id %>">
                                                            <span class="icon icon-bag"></span>
                                                            <span class="tooltip">Add to Cart</span>
                                                        </a>
                                                        <a href="javascript:void(0);"
                                                            class="box-icon bg_white wishlist btn-icon-action"
                                                            data-product-id="<%= product._id %>"
                                                            data-user-id="<%= locals.userData?._id %>">
                                                            <span class="icon icon-heart"></span>
                                                            <span class="tooltip">Add to Wishlist</span>
                                                            <span class="icon icon-delete"></span>
                                                        </a>
                                                        <% } %>
                                                </div>
                                            </div>
                                            <div class="card-product-info">
                                                <a href="/product/<%= product._id %>" class="title link">
                                                    <%= product.productName %>
                                                </a>
                                                <div class="price-container">
                                                    <% if (hasDiscount ) { %>
                                                        <span
                                                            class="original-price text-muted text-decoration-line-through">
                                                            ₹<%= product.price.toFixed(2) %>
                                                        </span>
                                                        <span class="offer-price">
                                                            ₹<%=discountedPrice.toFixed(2)  %>
                                                        </span>
                                                        <% } else { %>
                                                            <span class="price">₹<%= product.price.toFixed(2) %></span>
                                                            <% } %>
                                                            
                                                </div>
                                            </div>
                                        </div>
                            <% }); %>
                        </div>
                    </div>
                </div>
            </section>


            <div class="container mt-4">
                <ul class="pagination justify-content-center">
                    <% if (currentPage> 1) { %>
                        <li class="page-item">
                            <a class="page-link" href="?page=<%= currentPage - 1 %>" aria-label="Previous">
                                <span aria-hidden="true">&laquo; Previous</span>
                            </a>
                        </li>
                        <% } %>
                            <% for (let i=1; i <=totalPages; i++) { %>
                                <li class="page-item <%= i === currentPage ? 'active' : '' %>">
                                    <a class="page-link" href="?page=<%= i %>">
                                        <%= i %>
                                    </a>
                                </li>
                                <% } %>
                                    <% if (currentPage < totalPages) { %>
                                        <li class="page-item">
                                            <a class="page-link" href="?page=<%= currentPage + 1 %>" aria-label="Next">
                                                <span aria-hidden="true">Next &raquo;</span>
                                            </a>
                                        </li>
                                        <% } %>
                </ul>
            </div>
        </div>

        </div>
        </section>
        <footer id="footer" class="footer">
            <div class="footer-wrap">
                <div class="footer-body">
                    <div class="container">
                        <div class="row">
                            <div class="col-xl-3 col-md-6 col-12">
                                <div class="footer-infor">
                                    <div class="footer-logo">
                                        <a href="index.html">
                                            <img src="images/logo/logo.svg" alt="">
                                        </a>
                                    </div>
                                    <ul>
                                        <li>
                                            <p>Address: 1234 Fashion Street, Suite 567, <br> New York, NY 10001</p>
                                        </li>
                                        <li>
                                            <p>Email: <a href="#">info@fashionshop.com</a></p>
                                        </li>
                                        <li>
                                            <p>Phone: <a href="#">(212) 555-1234</a></p>
                                        </li>
                                    </ul>
                                    <a href="contact-1.html" class="tf-btn btn-line">Get direction<i
                                            class="icon icon-arrow1-top-left"></i></a>
                                    <ul class="tf-social-icon d-flex gap-10">
                                        <li><a href="#" class="box-icon w_34 round social-facebook border-line-black"><i
                                                    class="icon fs-14 icon-fb"></i></a></li>
                                        <li><a href="#" class="box-icon w_34 round social-twiter border-line-black"><i
                                                    class="icon fs-12 icon-Icon-x"></i></a></li>
                                        <li><a href="#"
                                                class="box-icon w_34 round social-instagram border-line-black"><i
                                                    class="icon fs-14 icon-instagram"></i></a></li>
                                        <li><a href="#" class="box-icon w_34 round social-tiktok border-line-black"><i
                                                    class="icon fs-14 icon-tiktok"></i></a></li>
                                        <li><a href="#"
                                                class="box-icon w_34 round social-pinterest border-line-black"><i
                                                    class="icon fs-14 icon-pinterest-1"></i></a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="col-xl-3 col-md-6 col-12 footer-col-block">
                                <div class="footer-heading footer-heading-desktop">
                                    <h6>Help</h6>
                                </div>
                                <div class="footer-heading footer-heading-moblie">
                                    <h6>Help</h6>
                                </div>
                                <ul class="footer-menu-list tf-collapse-content">
                                    <li>
                                        <a href="privacy-policy.html" class="footer-menu_item">Privacy Policy</a>
                                    </li>
                                    <li>
                                        <a href="delivery-return.html" class="footer-menu_item"> Returns + Exchanges
                                        </a>
                                    </li>
                                    <li>
                                        <a href="shipping-delivery.html" class="footer-menu_item">Shipping</a>
                                    </li>
                                    <li>
                                        <a href="terms-conditions.html" class="footer-menu_item">Terms &amp;
                                            Conditions</a>
                                    </li>
                                    <li>
                                        <a href="faq-1.html" class="footer-menu_item">FAQ’s</a>
                                    </li>
                                    <li>
                                        <a href="compare.html" class="footer-menu_item">Compare</a>
                                    </li>
                                    <li>
                                        <a href="wishlist.html" class="footer-menu_item">My Wishlist</a>
                                    </li>
                                </ul>
                            </div>
                            <div class="col-xl-3 col-md-6 col-12 footer-col-block">
                                <div class="footer-heading footer-heading-desktop">
                                    <h6>About us</h6>
                                </div>
                                <div class="footer-heading footer-heading-moblie">
                                    <h6>About us</h6>
                                </div>
                                <ul class="footer-menu-list tf-collapse-content">
                                    <li>
                                        <a href="about-us.html" class="footer-menu_item">Our Story</a>
                                    </li>
                                    <li>
                                        <a href="our-store.html" class="footer-menu_item">Visit Our Store</a>
                                    </li>
                                    <li>
                                        <a href="contact-1.html" class="footer-menu_item">Contact Us</a>
                                    </li>
                                    <li>
                                        <a href="login.html" class="footer-menu_item">Account</a>
                                    </li>
                                </ul>
                            </div>
                            <div class="col-xl-3 col-md-6 col-12">
                                <div class="footer-newsletter footer-col-block">
                                    <div class="footer-heading footer-heading-desktop">
                                        <h6>Sign Up for Email</h6>
                                    </div>
                                    <div class="footer-heading footer-heading-moblie">
                                        <h6>Sign Up for Email</h6>
                                    </div>
                                    <div class="tf-collapse-content">
                                        <div class="footer-menu_item">Sign up to get first dibs on new arrivals, sales,
                                            exclusive content, events and more!</div>
                                        <form class="form-newsletter" id="subscribe-form" action="#" method="post"
                                            accept-charset="utf-8" data-mailchimp="true">
                                            <div id="subscribe-content">
                                                <fieldset class="email">
                                                    <input type="email" name="email-form" id="subscribe-email"
                                                        placeholder="Enter your email...." tabindex="0"
                                                        aria-required="true">
                                                </fieldset>
                                                <div class="button-submit">
                                                    <button id="subscribe-button"
                                                        class="tf-btn btn-sm radius-3 btn-fill btn-icon animate-hover-btn"
                                                        type="button">Subscribe<i
                                                            class="icon icon-arrow1-top-left"></i></button>
                                                </div>
                                            </div>
                                            <div id="subscribe-msg"></div>
                                        </form>
                                        <div class="tf-cur">
                                            <div class="tf-currencies">
                                                <div
                                                    class="dropdown bootstrap-select image-select center style-default type-currencies">
                                                    <select class="image-select center style-default type-currencies">
                                                        <option data-thumbnail="images/country/fr.svg"
                                                            data-content="<img src='images/country/fr.svg'/> EUR € | France">
                                                            EUR € | France</option>
                                                        <option data-thumbnail="images/country/de.svg"
                                                            data-content="<img src='images/country/de.svg'/> EUR € | Germany">
                                                            EUR € | Germany</option>
                                                        <option selected="" data-thumbnail="images/country/us.svg"
                                                            data-content="<img src='images/country/us.svg'/> USD $ | United States">
                                                            USD $ | United States</option>
                                                        <option data-thumbnail="images/country/vn.svg"
                                                            data-content="<img src='images/country/vn.svg'/> VND ₫ | Vietnam">
                                                            VND ₫ | Vietnam</option>
                                                    </select><button type="button" tabindex="-1"
                                                        class="btn dropdown-toggle btn-light" data-bs-toggle="dropdown"
                                                        role="combobox" aria-owns="bs-select-1" aria-haspopup="listbox"
                                                        aria-expanded="false" title="USD $ | United States">
                                                        <div class="filter-option">
                                                            <div class="filter-option-inner">
                                                                <div class="filter-option-inner-inner"><img
                                                                        src="images/country/us.svg"> USD $ | United
                                                                    States
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </button>
                                                    <div class="dropdown-menu ">
                                                        <div class="inner show" role="listbox" id="bs-select-1"
                                                            tabindex="-1">
                                                            <ul class="dropdown-menu inner show" role="presentation">
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="tf-languages">
                                                <div
                                                    class="dropdown bootstrap-select image-select center style-default type-languages">
                                                    <select class="image-select center style-default type-languages">
                                                        <option>English</option>
                                                        <option>العربية</option>
                                                        <option>简体中文</option>
                                                        <option>اردو</option>
                                                    </select><button type="button" tabindex="-1"
                                                        class="btn dropdown-toggle btn-light" data-bs-toggle="dropdown"
                                                        role="combobox" aria-owns="bs-select-2" aria-haspopup="listbox"
                                                        aria-expanded="false" title="English">
                                                        <div class="filter-option">
                                                            <div class="filter-option-inner">
                                                                <div class="filter-option-inner-inner">English</div>
                                                            </div>
                                                        </div>
                                                    </button>
                                                    <div class="dropdown-menu ">
                                                        <div class="inner show" role="listbox" id="bs-select-2"
                                                            tabindex="-1">
                                                            <ul class="dropdown-menu inner show" role="presentation">
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="footer-bottom">
                    <div class="container">
                        <div class="row">
                            <div class="col-12">
                                <div
                                    class="footer-bottom-wrap d-flex gap-20 flex-wrap justify-content-between align-items-center">
                                    <div class="footer-menu_item">© 2024 WatchAura Store. All Rights Reserved</div>
                                    <div class="tf-payment">
                                        <img src="images/payments/visa.png" alt="">
                                        <img src="images/payments/img-1.png" alt="">
                                        <img src="images/payments/img-2.png" alt="">
                                        <img src="images/payments/img-3.png" alt="">
                                        <img src="images/payments/img-4.png" alt="">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
        <script src="https://cdn.jsdelivr.net/npm/notyf/notyf.min.js"></script>
        <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

        <!-- ADD TO CART -->
        <script>

            document.querySelectorAll('.quick-add').forEach(link => {
                link.addEventListener('click', async function (event) {
                    event.preventDefault();

                    const productId = this.getAttribute('data-product-id');
                    const userId = this.getAttribute('data-user-id');
                    const quantity = 1;
                    const notyf = new Notyf({
                        duration: 5000,
                        position: { x: 'center', y: 'bottom' },
                    });

                    try {
                        const response = await fetch('/addCartItem', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ productId, quantity, userId }),
                        });

                        const data = await response.json();

                        if (data.success) {
                            notyf.success(data.message);
                            setTimeout(() => window.location.reload(), 1500);
                        } else {
                            notyf.error(data.message);
                        }
                    } catch (error) {
                        // console.error('Error:', error);
                        notyf.error("Failed to add product to cart");
                    }
                });
            });

            //  ADD TO WISHLIST
            document.querySelectorAll('.wishlist').forEach(link => {
                link.addEventListener('click', async function (event) {
                    event.preventDefault();

                    const productId = this.getAttribute('data-product-id');
                    const userId = this.getAttribute('data-user-id');
                    const notyf = new Notyf({
                        duration: 5000,
                        position: { x: 'center', y: 'bottom' },
                    });

                    try {
                        const response = await fetch('/addWishlistItem', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ productId, userId }),
                        });

                        const data = await response.json();

                        if (data.success) {
                            notyf.success(data.message);
                        } else {
                            notyf.error(data.message);
                        }
                    } catch (error) {
                        // console.error('Error:', error);
                        notyf.error("Failed to add product to wishlist");
                    }
                });
            });
        </script>



        <!-- SEARCH , FILTER , -->


        <script>

            document.addEventListener('DOMContentLoaded', function () {
                const searchInput = document.getElementById('searchInput');
                const sortSelect = document.getElementById('sortSelect');
                const categorySelect = document.getElementById('categorySelect');
                const minPrice = document.getElementById('minPrice');
                const maxPrice = document.getElementById('maxPrice');


                function debounce(func, wait) {
                    let timeout;
                    return function executedFunction(...args) {
                        const later = () => {
                            clearTimeout(timeout);
                            func(...args);
                        };
                        clearTimeout(timeout);
                        timeout = setTimeout(later, wait);
                    };
                }


                function updateFilters() {
                    const params = new URLSearchParams();

                    if (searchInput.value) params.set('search', searchInput.value);
                    if (sortSelect.value) params.set('sort', sortSelect.value);
                    if (categorySelect.value) params.set('category', categorySelect.value);
                    if (minPrice.value) params.set('minPrice', minPrice.value);
                    if (maxPrice.value) params.set('maxPrice', maxPrice.value);

                    window.location.href = `${window.location.pathname}?${params.toString()}`;
                }

                searchInput.addEventListener('input', debounce(updateFilters, 1000));
                minPrice.addEventListener('input', debounce(updateFilters, 1000));
                maxPrice.addEventListener('input', debounce(updateFilters, 1000));


                sortSelect.addEventListener('change', updateFilters);
                categorySelect.addEventListener('change', updateFilters);
            });
        </script>
        <%- include('../user-layouts/footer.ejs') %>