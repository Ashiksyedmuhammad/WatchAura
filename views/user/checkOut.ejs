<%- include('../user-layouts/header.ejs') %>



<style>
    .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .tf-page-cart-wrap {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        .tf-page-cart-item {
            flex: 1;
            min-width: 300px;
        }
        .tf-page-cart-footer {
            flex: 1;
            min-width: 300px;
        }
        .address-card {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            position: relative;
        }
        .edit-address {
            position: absolute;
            top: 10px;
            right: 10px;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        #addressForm input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
        }
        .tf-btn {
            background-color: #000000;
            border: none;
            color: white;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 5px;
        }
</style>

</head>
    <body class="preload-wrapper">
    <!-- preload -->
    <!-- <div class="preload preload-container">
        <div class="preload-logo">
            <div class="spinner"></div>
        </div>
    </div> -->
    <!-- /preload -->
    <div id="wrapper">
        <!-- Top bar -->
        <div class="tf-top-bar bg_white line">
            <div class="px_15 lg-px_40">

            </div>
        </div>
        <!-- /Top bar -->
        <!-- Header -->
        <header id="header" class="header-default">
            <div class="px_15 lg-px_40">
                <div class="row wrapper-header align-items-center">
                    <div class="col-md-4 col-3 tf-lg-hidden">
                        <a href="#mobileMenu" data-bs-toggle="offcanvas" aria-controls="offcanvasLeft">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="16" viewBox="0 0 24 16"
                                fill="none">
                                <path
                                    d="M2.00056 2.28571H16.8577C17.1608 2.28571 17.4515 2.16531 17.6658 1.95098C17.8802 1.73665 18.0006 1.44596 18.0006 1.14286C18.0006 0.839753 17.8802 0.549063 17.6658 0.334735C17.4515 0.120408 17.1608 0 16.8577 0H2.00056C1.69745 0 1.40676 0.120408 1.19244 0.334735C0.978109 0.549063 0.857702 0.839753 0.857702 1.14286C0.857702 1.44596 0.978109 1.73665 1.19244 1.95098C1.40676 2.16531 1.69745 2.28571 2.00056 2.28571ZM0.857702 8C0.857702 7.6969 0.978109 7.40621 1.19244 7.19188C1.40676 6.97755 1.69745 6.85714 2.00056 6.85714H22.572C22.8751 6.85714 23.1658 6.97755 23.3801 7.19188C23.5944 7.40621 23.7148 7.6969 23.7148 8C23.7148 8.30311 23.5944 8.59379 23.3801 8.80812C23.1658 9.02245 22.8751 9.14286 22.572 9.14286H2.00056C1.69745 9.14286 1.40676 9.02245 1.19244 8.80812C0.978109 8.59379 0.857702 8.30311 0.857702 8ZM0.857702 14.8571C0.857702 14.554 0.978109 14.2633 1.19244 14.049C1.40676 13.8347 1.69745 13.7143 2.00056 13.7143H12.2863C12.5894 13.7143 12.8801 13.8347 13.0944 14.049C13.3087 14.2633 13.4291 14.554 13.4291 14.8571C13.4291 15.1602 13.3087 15.4509 13.0944 15.6653C12.8801 15.8796 12.5894 16 12.2863 16H2.00056C1.69745 16 1.40676 15.8796 1.19244 15.6653C0.978109 15.4509 0.857702 15.1602 0.857702 14.8571Z"
                                    fill="currentColor"></path>
                            </svg>
                        </a>
                    </div>
                    <div class="col-xl-3 col-md-4 col-6">
                        <a href="index.html" class="logo-header">
                            <img src="assets/images/logo/logo.svg" alt="logo" class="logo">
                        </a>
                    </div>
                    <div class="col-xl-6 tf-md-hidden">
                        <nav class="box-navigation text-center">
                            <ul class="box-nav-ul d-flex align-items-center justify-content-center gap-30">
                                <li class="menu-item">
                                    <a href="/" class="item-link">Home<i class="icon icon-arrow-down"></i></a>
                                </li>
                                <li class="menu-item">
                                    <a href="/shop" class="item-link">Shope<i class="icon icon-arrow-down"></i></a>
                                </li>
                                <li class="menu-item">
                                    <a href="#" class="item-link">About<i class="icon icon-arrow-down"></i></a>
                                </li>
                                <li class="menu-item">
                                    <a href="#" class="item-link">Contact<i class="icon icon-arrow-down"></i></a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                    <div class="col-xl-3 col-md-4 col-3">
                        <ul class="nav-icon d-flex justify-content-end align-items-center gap-20">
                            <!-- Search Icon -->
                            <li class="nav-search">
                                <a href="#canvasSearch" data-bs-toggle="offcanvas" aria-controls="offcanvasLeft"
                                    class="nav-icon-item">
                                    <i class="icon icon-search"></i>
                                </a>
                            </li>

                            <!-- Conditional for showing Logout and User name if logged in, or Login if not -->
                            <% if(locals.userData){ %>
                                <!-- Show Logout Button -->
                                <li class="nav-logout">
                                    <form action="/logout" method="POST" class="nav-icon-item" style="display: inline;">
                                        <button type="submit" class="btn-logout"
                                            style="background: none; border: none; padding: 0; cursor: pointer;">
                                            <i class="icon icon-logout"></i> Logout
                                        </button>
                                    </form>
                                </li>

                                <!-- Show User Name -->
                                <li class="nav-user">
                                    <p class="mb-0">
                                        <%= locals.userData[0]?.firstName %>
                                    </p>
                                </li>
                                <% } else { %>
                                    <!-- Show Login Button if not logged in -->
                                    <li class="nav-account">
                                        <a href="#login" data-bs-toggle="modal" class="nav-icon-item">
                                            <i class="icon icon-account"></i> Login
                                        </a>
                                    </li>
                                    <% } %>

                                        <!-- Wishlist Icon -->
                                        <li class="nav-wishlist">
                                            <a href="wishlist.html" class="nav-icon-item">
                                                <i class="icon icon-heart"></i><span class="count-box">0</span>
                                            </a>
                                        </li>

                                        <!-- Cart Icon -->
                                        <li class="nav-cart">
                                            <a href="#shoppingCart" data-bs-toggle="modal" class="nav-icon-item">
                                                <i class="icon icon-bag"></i><span class="count-box">0</span>
                                            </a>
                                        </li>
                        </ul>
                    </div>

                </div>
            </div>

        </header>

        <div class="tf-page-title">
            <div class="container-full">
                <div class="heading text-center">Check Out</div>
            </div>
        </div>
        <!-- ADDRESS SECTION -->
        <section class="flat-spacing-11">
            <div class="container">
                <div class="tf-page-cart-wrap layout-2">
                    <div class="tf-page-cart-item">
                        <h5 class="fw-5 mb_20">Billing details</h5>
                        
                        <!-- Address Section -->
                        <div id="addressSection">
                            <button id="addAddressBtn" class="tf-btn btn-sm radius-3 btn-fill btn-icon animate-hover-btn">
                                Add New Address
                            </button>
                            
                            <div id="addressList">
                                <!-- Address cards will be dynamically added here -->
                            </div>
                        </div>
    
                        <!-- Add Address Modal -->
                        <div id="addressModal" class="modal">
                            <div class="modal-content">
                                <span class="close">&times;</span>
                                <h5>Add New Address</h5>
                                <form id="addressForm">
                                    <input type="text" name="name" placeholder="Full Name" required>
                                    <input type="tel" name="mobile" placeholder="Mobile Number" required>
                                    <input type="text" name="locality" placeholder="Locality" required>
                                    <input type="text" name="city" placeholder="Town/City" required>
                                    <input type="text" name="pincode" placeholder="Pincode" required>
                                    <input type="text" name="landmark" placeholder="Landmark">
                                    <input type="text" name="state" placeholder="State" required>
                                    <button type="submit" class="tf-btn radius-3 btn-fill btn-icon animate-hover-btn">Save Address</button>
                                </form>
                            </div>
                        </div>
                    </div>
    
                    <!-- ORDER SECTION -->
                    <div class="tf-page-cart-footer">
                        <div class="tf-cart-footer-inner">
                            <h5 class="fw-5 mb_20">Your order</h5>
                            <form class="tf-page-cart-checkout widget-wrap-checkout" method="POST" action="/place-order">
                                <ul class="wrap-checkout-product">
                                    <% cart.items.forEach((item) => { %>
                                        <li class="checkout-product-item">
                                            <figure class="img-product">
                                                <img src="/uploads/<%= item.productId.images[0] %>"
                                                    alt="<%= item.productId.productName %>"
                                                    style="width: 60px; height: 60px; object-fit: cover;">
                                                <span class="quantity"><%= item.quantity %></span>
                                            </figure>
                                            <div class="content">
                                                <div class="info">
                                                    <p class="name"><%= item.productId.productName %></p>
                                                    <span class="variant">Price: $<%= item.productId.price.toFixed(2) %></span>
                                                </div>
                                                <span class="price">$<%= (item.productId.price * item.quantity).toFixed(2) %></span>
                                            </div>
                                        </li>
                                    <% }) %>
                                </ul>
    
                                <div class="d-flex justify-content-between line pb_20">
                                    <h6 class="fw-5">Total</h6>
                                    <h6 class="total fw-5">$<%= subTotal.toFixed(2) %></h6>
                                </div>
                                <div>
                                    <hr>
                                </div>
                                <div class="wd-check-payment">
                                    <div class="fieldset-radio mb_20">
                                        <input type="radio" name="paymentMethod" id="upi" value="upi" class="tf-check" checked>
                                        <label for="upi">UPI Payment</label>
                                    </div>
                                    <div class="fieldset-radio mb_20">
                                        <input type="radio" name="paymentMethod" id="cod" value="cod" class="tf-check">
                                        <label for="cod">Cash on delivery</label>
                                    </div>
                                    <p class="text_black-2 mb_20">Your personal data will be used to process your order,
                                        support your experience throughout this website, and for other purposes
                                        described in our <a href="privacy-policy.html" class="text-decoration-underline">privacy policy</a>.</p>
                                </div>
    
                                <button type="submit" class="tf-btn radius-3 btn-fill btn-icon animate-hover-btn justify-content-center">
                                    Place order
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <footer id="footer" class="footer">
            <div class="footer-wrap">
                <div class="footer-body">
                    <div class="container">
                        <div class="row">
                            <div class="col-xl-3 col-md-6 col-12">
                                <div class="footer-infor">
                                    <div class="footer-logo">
                                        <a href="index.html">
                                            <img src="images/logo/logo.svg" alt="">
                                        </a>
                                    </div>
                                    <ul>
                                        <li>
                                            <p>Address: 1234 Fashion Street, Suite 567, <br> New York, NY 10001</p>
                                        </li>
                                        <li>
                                            <p>Email: <a href="#">info@fashionshop.com</a></p>
                                        </li>
                                        <li>
                                            <p>Phone: <a href="#">(212) 555-1234</a></p>
                                        </li>
                                    </ul>
                                    <ul class="tf-social-icon d-flex gap-10">
                                        <li><a href="#" class="box-icon w_34 round social-facebook border-line-black"><i
                                                    class="icon fs-14 icon-fb"></i></a></li>
                                        <li><a href="#" class="box-icon w_34 round social-twiter border-line-black"><i
                                                    class="icon fs-12 icon-Icon-x"></i></a></li>
                                        <li><a href="#"
                                                class="box-icon w_34 round social-instagram border-line-black"><i
                                                    class="icon fs-14 icon-instagram"></i></a></li>
                                        <li><a href="#" class="box-icon w_34 round social-tiktok border-line-black"><i
                                                    class="icon fs-14 icon-tiktok"></i></a></li>
                                        <li><a href="#"
                                                class="box-icon w_34 round social-pinterest border-line-black"><i
                                                    class="icon fs-14 icon-pinterest-1"></i></a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="col-xl-3 col-md-6 col-12 footer-col-block">
                                <div class="footer-heading footer-heading-desktop">
                                    <h6>Help</h6>
                                </div>

                                <ul class="footer-menu-list tf-collapse-content">
                                    <li>
                                        <a href="privacy-policy.html" class="footer-menu_item">Privacy Policy</a>
                                    </li>
                                    <li>
                                        <a href="delivery-return.html" class="footer-menu_item"> Returns + Exchanges
                                        </a>
                                    </li>
                                    <li>
                                        <a href="shipping-delivery.html" class="footer-menu_item">Shipping</a>
                                    </li>
                                    <li>
                                        <a href="terms-conditions.html" class="footer-menu_item">Terms &amp;
                                            Conditions</a>
                                    </li>
                                    <li>
                                        <a href="faq-1.html" class="footer-menu_item">FAQ’s</a>
                                    </li>
                                    <li>
                                        <a href="compare.html" class="footer-menu_item">Compare</a>
                                    </li>
                                    <li>
                                        <a href="wishlist.html" class="footer-menu_item">My Wishlist</a>
                                    </li>
                                </ul>
                            </div>
                            <div class="col-xl-3 col-md-6 col-12 footer-col-block">
                                <div class="footer-heading footer-heading-desktop">
                                    <h6>About us</h6>
                                </div>

                                <ul class="footer-menu-list tf-collapse-content">
                                    <li>
                                        <a href="about-us.html" class="footer-menu_item">Our Story</a>
                                    </li>
                                    <li>
                                        <a href="our-store.html" class="footer-menu_item">Visit Our Store</a>
                                    </li>
                                    <li>
                                        <a href="contact-1.html" class="footer-menu_item">Contact Us</a>
                                    </li>
                                    <li>
                                        <a href="login.html" class="footer-menu_item">Account</a>
                                    </li>
                                </ul>
                            </div>
                            <div class="col-xl-3 col-md-6 col-12">
                                <div class="footer-newsletter footer-col-block">

                                    <div class="footer-heading footer-heading-moblie">
                                        <h6>Sign Up for Email</h6>
                                    </div>
                                    <div class="tf-collapse-content">
                                        <div class="footer-menu_item">Sign up to get first dibs on new arrivals, sales,
                                            exclusive content, events and more!</div>
                                        <form class="form-newsletter" id="subscribe-form" action="#" method="post"
                                            accept-charset="utf-8" data-mailchimp="true">
                                            <div id="subscribe-content">
                                                <fieldset class="email">
                                                    <input type="email" name="email-form" id="subscribe-email"
                                                        placeholder="Enter your email...." tabindex="0"
                                                        aria-required="true">
                                                </fieldset>
                                                <div class="button-submit">
                                                    <button id="subscribe-button"
                                                        class="tf-btn btn-sm radius-3 btn-fill btn-icon animate-hover-btn"
                                                        type="button">Subscribe<i
                                                            class="icon icon-arrow1-top-left"></i></button>
                                                </div>
                                            </div>
                                            <div id="subscribe-msg"></div>
                                        </form>
                                        <div class="tf-cur">
                                            <div class="tf-currencies">
                                                <div
                                                    class="dropdown bootstrap-select image-select center style-default type-currencies">
                                                    <select class="image-select center style-default type-currencies">
                                                        <option data-thumbnail="images/country/fr.svg"
                                                            data-content="<img src='images/country/fr.svg'/> EUR € | France">
                                                            EUR € | France</option>
                                                        <option data-thumbnail="images/country/de.svg"
                                                            data-content="<img src='images/country/de.svg'/> EUR € | Germany">
                                                            EUR € | Germany</option>
                                                        <option selected="" data-thumbnail="images/country/us.svg"
                                                            data-content="<img src='images/country/us.svg'/> USD $ | United States">
                                                            USD $ | United States</option>
                                                        <option data-thumbnail="images/country/vn.svg"
                                                            data-content="<img src='images/country/vn.svg'/> VND ₫ | Vietnam">
                                                            VND ₫ | Vietnam</option>
                                                    </select>

                                                    <div class="dropdown-menu ">
                                                        <div class="inner show" role="listbox" id="bs-select-1"
                                                            tabindex="-1">
                                                            <ul class="dropdown-menu inner show" role="presentation">
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="tf-languages">
                                                <div
                                                    class="dropdown bootstrap-select image-select center style-default type-languages">
                                                    <select class="image-select center style-default type-languages">
                                                        <option>English</option>
                                                        <option>العربية</option>
                                                        <option>简体中文</option>
                                                        <option>اردو</option>
                                                    </select>

                                                    <div class="dropdown-menu ">
                                                        <div class="inner show" role="listbox" id="bs-select-2"
                                                            tabindex="-1">
                                                            <ul class="dropdown-menu inner show" role="presentation">
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="footer-bottom">
                    <div class="container">
                        <div class="row">
                            <div class="col-12">
                                <div
                                    class="footer-bottom-wrap d-flex gap-20 flex-wrap justify-content-between align-items-center">
                                    <div class="footer-menu_item">© 2024 Ecomus Store. All Rights Reserved</div>
                                    <div class="tf-payment">
                                        <img src="images/payments/visa.png" alt="">
                                        <img src="images/payments/img-1.png" alt="">
                                        <img src="images/payments/img-2.png" alt="">
                                        <img src="images/payments/img-3.png" alt="">
                                        <img src="images/payments/img-4.png" alt="">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </footer>


        <script>
                 document.addEventListener('DOMContentLoaded', function() {
            const addAddressBtn = document.getElementById('addAddressBtn');
            const addressModal = document.getElementById('addressModal');
            const closeBtn = addressModal.querySelector('.close');
            const addressForm = document.getElementById('addressForm');
            const addressList = document.getElementById('addressList');

            addAddressBtn.onclick = function() {
                addressModal.style.display = 'block';
            }

            closeBtn.onclick = function() {
                addressModal.style.display = 'none';
            }

            window.onclick = function(event) {
                if (event.target == addressModal) {
                    addressModal.style.display = 'none';
                }
            }

            addressForm.onsubmit = function(e) {
                e.preventDefault();
                const formData = new FormData(addressForm);
                const addressData = Object.fromEntries(formData.entries());
                
                // Add address card
                const addressCard = document.createElement('div');
                addressCard.className = 'address-card';
                addressCard.innerHTML = `
                    <p><strong>${addressData.name}</strong></p>
                    <p>${addressData.mobile}</p>
                    <p>${addressData.locality}, ${addressData.city}, ${addressData.state} - ${addressData.pincode}</p>
                    <p>Landmark: ${addressData.landmark || 'N/A'}</p>
                    <button class="edit-address tf-btn">Edit</button>
                `;
                addressList.appendChild(addressCard);

                // Close modal and reset form
                addressModal.style.display = 'none';
                addressForm.reset();
            }

            // Edit address functionality
            addressList.addEventListener('click', function(e) {
                if (e.target.classList.contains('edit-address')) {
                    const addressCard = e.target.closest('.address-card');
                    const addressData = {
                        name: addressCard.querySelector('strong').textContent,
                        mobile: addressCard.querySelectorAll('p')[1].textContent,
                        locality: addressCard.querySelectorAll('p')[2].textContent.split(',')[0].trim(),
                        city: addressCard.querySelectorAll('p')[2].textContent.split(',')[1].trim(),
                        state: addressCard.querySelectorAll('p')[2].textContent.split(',')[2].split('-')[0].trim(),
                        pincode: addressCard.querySelectorAll('p')[2].textContent.split('-')[1].trim(),
                        landmark: addressCard.querySelectorAll('p')[3].textContent.replace('Landmark:', '').trim()
                    };

                    // Populate form with existing data
                    Object.keys(addressData).forEach(key => {
                        const input = addressForm.querySelector(`[name="${key}"]`);
                        if (input) {
                            input.value = addressData[key];
                        }
                    });

                    // Open modal for editing
                    addressModal.style.display = 'block';
                }
            });
        }); 
        </script>
    
        <%- include('../user-layouts/footer.ejs') %>